<!DOCTYPE html>
<html lang="und" style="width:100%;height:100%;background-color:black;">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
		<meta name="description" content="Eaglercraft 1.12 test directory HTML page">
		<meta name="keywords" content="eaglercraft, eaglercraftx, minecraft, 1.12, 1.12.2">
		<title>Eaglercraft 1.12.2</title>
		<meta property="og:locale" content="en-US">
		<meta property="og:type" content="website">
		<meta property="og:title" content="Eaglercraft 1.12.2">
		<meta property="og:description" content="test directory HTML page">
		<link type="image/png" rel="shortcut icon" href="favicon.png">
		<!-- Intercept classes.js and classes.js.map using fetch and modify before loading -->
		<script type="text/javascript">
			// Block the original script and sourcemap from loading
			const originalCreateElement = document.createElement;
			document.createElement = function(tagName) {
				const element = originalCreateElement.call(document, tagName);
				if (tagName.toLowerCase() === 'script') {
					const originalSetAttribute = element.setAttribute;
					element.setAttribute = function(name, value) {
						if (name === 'src' && (value === 'classes.js' || value.includes('classes.js.map'))) {
							console.log('Blocking original ' + value + ' from loading');
							// Don't set src, we'll handle loading ourselves
							return;
						}
						return originalSetAttribute.call(this, name, value);
					};
				}
				return element;
			};

			// Block any sourcemap references
			const originalAppendChild = Element.prototype.appendChild;
			Element.prototype.appendChild = function(child) {
				if (child && child.tagName === 'SCRIPT') {
					// Remove any sourceMappingURL comments
					if (child.text && child.text.includes('sourceMappingURL=classes.js.map')) {
						child.text = child.text.replace(/\/\/# sourceMappingURL=classes\.js\.map/g, '');
						console.log('Removed sourcemap reference from script');
					}
				}
				return originalAppendChild.call(this, child);
			};

			// Fetch and modify classes.js
			fetch('classes.js')
				.then(response => response.text())
				.then(code => {
					// Remove any sourcemap references
					let modifiedCode = code.replace(/\/\/# sourceMappingURL=classes\.js\.map/g, '');
					
					// Replace drawSplashScreen function with empty implementation
					// Pattern 1: Direct function assignment 
					modifiedCode = modifiedCode.replace(
						/(\w+\.prototype\.drawSplashScreen|\w+\.drawSplashScreen)\s*=\s*function\s*\([^)]*\)\s*\{[^}]*\}/g,
						'$1=function(){/* Splash screen disabled */}'
					);
					
					// Pattern 2: In obfuscated code with "BAd","Fke","drawSplashScreen"
					const splashIndex = modifiedCode.indexOf('"drawSplashScreen"');
					if (splashIndex > -1) {
						// Get context before and after for analysis
						const contextSize = 2000; // Larger context to better catch the function
						const start = Math.max(0, splashIndex - contextSize);
						const end = Math.min(modifiedCode.length, splashIndex + contextSize);
						const context = modifiedCode.substring(start, end);
						
						// Look for function patterns after the "drawSplashScreen" string
						const functionMatches = context.match(/function\s*\([^)]*\)\s*\{[^{}]*(\{[^{}]*\}[^{}]*)*\}/g);
						if (functionMatches && functionMatches.length > 0) {
							// Replace functions that are likely the drawSplashScreen implementation
							for (const match of functionMatches) {
								// Only replace if the function appears after the drawSplashScreen string in context
								const matchIndex = context.indexOf(match);
								if (matchIndex > context.indexOf('"drawSplashScreen"')) {
									modifiedCode = modifiedCode.replace(
										match,
										'function(){/* Splash screen disabled */}'
									);
									console.log('Replaced potential splash screen function');
									break; // Replace only the first matching function after drawSplashScreen
								}
							}
						}
					}
					
					// Create and execute the modified script
					const script = document.createElement('script');
					script.type = 'text/javascript';
					script.text = modifiedCode;
					document.head.appendChild(script);
					console.log('Modified classes.js loaded with splash screen disabled');
				})
				.catch(error => {
					console.error('Error intercepting classes.js:', error);
					// Fallback: Load original script but still block sourcemap
					const script = document.createElement('script');
					script.type = 'text/javascript';
					script.src = 'classes.js';
					document.head.appendChild(script);
				});
				
			// Block any direct attempt to load the sourcemap
			const originalXHROpen = XMLHttpRequest.prototype.open;
			XMLHttpRequest.prototype.open = function(method, url, ...args) {
				if (url && typeof url === 'string' && url.includes('classes.js.map')) {
					console.log('Blocked XHR request to sourcemap');
					// Redirect to a non-existent file or return empty response
					url = 'data:application/json,{}';
				}
				return originalXHROpen.call(this, method, url, ...args);
			};
			
			// Also block fetch API attempts to load the sourcemap
			const originalFetch = window.fetch;
			window.fetch = function(input, init) {
				if (input && typeof input === 'string' && input.includes('classes.js.map')) {
					console.log('Blocked fetch request to sourcemap');
					// Return empty JSON response
					return Promise.resolve(new Response('{}', {
						status: 200,
						headers: { 'Content-Type': 'application/json' }
					}));
				}
				return originalFetch.call(this, input, init);
			};
		</script>
		<script src="/js/ga4.js"></script>
		<style>
			#splash-screen {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background-color: #2d2d2d;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				z-index: 9999;
				transition: opacity 0.5s ease-in-out;
			}
			
			.splash-logo {
				width: 200px;
				height: 200px;
				background-color: #5c8f3a;
				border-radius: 16px;
				margin-bottom: 20px;
				position: relative;
				overflow: hidden;
			}
			
			.splash-logo:before {
				content: "";
				position: absolute;
				width: 80px;
				height: 80px;
				background-color: #45702c;
				top: 60px;
				left: 60px;
				box-shadow: 
					80px -80px 0 -20px #45702c,
					0px -80px 0 -20px #45702c,
					-80px 0px 0 -20px #45702c,
					-80px -80px 0 -20px #45702c;
			}
			
			.loading-bar-container {
				width: 300px;
				height: 20px;
				background-color: #1a1a1a;
				border-radius: 10px;
				overflow: hidden;
				margin-bottom: 20px;
			}
			
			.loading-bar {
				width: 0%;
				height: 100%;
				background-color: #5c8f3a;
				transition: width 2s ease-in-out;
				border-radius: 10px;
			}
			
			.splash-text {
				color: white;
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
				font-size: 18px;
				text-align: center;
			}
		</style>
		<script type="text/javascript">
			"use strict";
			
			function hideSplashScreen() {
				const splash = document.getElementById("splash-screen");
				splash.style.opacity = "0";
				setTimeout(() => {
					splash.style.display = "none";
				}, 500);
			}
			
			function animateLoadingBar() {
				const loadingBar = document.getElementById("loading-bar");
				setTimeout(() => {
					loadingBar.style.width = "30%";
					setTimeout(() => {
						loadingBar.style.width = "60%";
						setTimeout(() => {
							loadingBar.style.width = "90%";
						}, 600);
					}, 800);
				}, 300);
			}
			
			window.addEventListener("load", function() {
				// Start loading animation immediately
				animateLoadingBar();
				
				if(window.location.href.indexOf("file:") === 0) {
					alert("HTTP please, do not open this file locally, run a local HTTP server and load it via HTTP");
				} else {
					var relayId = Math.floor(Math.random() * 3);
					window.eaglercraftXOpts = {
						demoMode: false,
						container: "game_frame",
						assetsURI: "assets.epk",
						localesURI: "lang/",
						worldsDB: "worlds",
						servers: []
					};
					
					// Hook into the main function
					const originalMain = window.main;
					window.main = function() {
						// Complete the loading bar animation
						const loadingBar = document.getElementById("loading-bar");
						loadingBar.style.width = "100%";
						
						// Add a small delay to show the completed loading bar before hiding splash screen
						setTimeout(() => {
							hideSplashScreen();
							originalMain();
						}, 500);
					};
					
					// Call main function after a slight delay to ensure splash screen shows properly
					setTimeout(() => {
						main();
					}, 2000);
				}
			});
		</script>
	</head>
	<body style="margin:0px;width:100%;height:100%;overflow:hidden;background-color:black;" id="game_frame">
		<!-- Splash Screen -->
		<div id="splash-screen">
			<div class="splash-logo"></div>
			<div class="loading-bar-container">
				<div id="loading-bar" class="loading-bar"></div>
			</div>
			<div class="splash-text">Loading Eaglercraft 1.12.2...</div>
		</div>
	</body>
</html>
