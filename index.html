<!DOCTYPE html>
<html lang="und" style="width:100%;height:100%;background-color:black;">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
        <meta name="description" content="Eaglercraft 1.12 test directory HTML page">
        <meta name="keywords" content="eaglercraft, eaglercraftx, minecraft, 1.12, 1.12.2">
        <title>Eaglercraft 1.12.2</title>
        <meta property="og:locale" content="en-US">
        <meta property="og:type" content="website">
        <meta property="og:title" content="Eaglercraft 1.12.2">
        <meta property="og:description" content="test directory HTML page">
        <link type="image/png" rel="shortcut icon" href="favicon.png">
        <styleellery
            #splash-screen {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: black;
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            }
            #splash-screen img {
                max-width: 50%;
                max-height: 50%;
            }
            #splash-screen.hidden {
                display: none;
            }
        </style>
    >/head>
    <body style="margin:0px;width:100%;height:100%;overflow:hidden;background-color:black;" id="game_frame">
        <div id="splash-screen">
            <img src="favicon.png" alt="Eaglercraft Logo">
        </div>
        <script type="text/javascript">
            "use strict";
            window.addEventListener("load", async function() {
                // Set flag to indicate main splash screen is active
                window.isSplashScreenActive = true;

                // Override DOM methods to block potential splash screens
                const originalCreateElement = document.createElement;
                const originalAppendChild = document.body.appendChild;
                document.createElement = function(tagName) {
                    if (window.isSplashScreenActive && (tagName === 'div' || tagName === 'canvas')) {
                        console.warn('Blocked creation of potential splash screen element:', tagName);
                        return null;
                    }
                    return originalCreateElement.apply(document, arguments);
                };
                document.body.appendChild = function(element) {
                    if (window.isSplashScreenActive && element && (element.tagName === 'DIV' || element.tagName === 'CANVAS')) {
                        console.warn('Blocked appending of potential splash screen element:', element);
                        return element;
                    }
                    return originalAppendChild.apply(document.body, arguments);
                };

                // Show splash screen for 5 seconds
                const splashScreen = document.getElementById("splash-screen");
                await new Promise(resolve => setTimeout(resolve, 5000));
                splashScreen.classList.add("hidden");

                // Restore DOM methods and clear flag
                document.createElement = originalCreateElement;
                document.body.appendChild = originalAppendChild;
                window.isSplashScreenActive = false;

                // Dynamically load scripts after splash screen
                const classesScript = document.createElement("script");
                classesScript.src = "classes.js";
                document.head.appendChild(classesScript);

                const ga4Script = document.createElement("script");
                ga4Script.src = "/js/ga4.js";
                document.head.appendChild(ga4Script);

                // Wait for classes.js to load before proceeding
                await new Promise(resolve => {
                    classesScript.onload = resolve;
                });

                // Original initialization code with added splash screen suppression
                if (window.location.href.indexOf("file:") === 0) {
                    alert("HTTP please, do not open this file locally, run a local HTTP server and load it via HTTP");
                } else {
                    var relayId = Math.floor(Math.random() * 3);
                    window.eaglercraftXOpts = {
                        demoMode: false,
                        container: "game_frame",
                        assetsURI: "assets.epk",
                        localesURI: "lang/",
                        worldsDB: "worlds",
                        servers: [],
                        disableSplashScreen: true // Signal to classes.js to skip its splash screen
                    };
                    main();
                }
            });

            // Note: If classes.js creates its own splash screen, ensure it checks
            // window.isSplashScreenActive or window.eaglercraftXOpts.disableSplashScreen
            // and skips its splash screen logic if either is true. Example in classes.js:
            // if (window.isSplashScreenActive || window.eaglercraftXOpts.disableSplashScreen) {
            //     return; /* skip splash screen */
            // }
        </script>
    </body>
</html>
